{
    "$schema": "http://json-schema.org/draft-04/schema#",
    "id": "file:///home/asharma/src/iterlib/python/complex.json",

    "type" : "object",
    "properties": {
        "query": { "$ref": "#/definitions/query" }
    },
    "definitions" : {
        "and-query" : {
            "type" : "array",
            "items": [
                {
                    "type" : "string",
                    "enum" : ["and"]
                },
                { "$ref" : "#/definitions/query" }
            ],
            "minItems": 3
        },

        "apply-query" : {
            "type" : "array",
            "items": [
                {
                    "type" : "string",
                    "enum" : ["apply"]
                },
                { "$ref" : "#/definitions/query" }
            ],
            "minItems": 3,
            "maxItems": 3
        },

        "aggregate-query": {
            "type" : "array",
            "items": [
                {
                    "type" : "string",
                    "enum" : ["aggregate"]
                },
                { "$ref" : "#/definitions/query" }
            ],
            "minItems": 2,
            "maxItems": 2
        },

        "difference-query": {
            "type" : "array",
            "items": [
                {
                    "type" : "string",
                    "enum" : ["difference"]
                },
                { "$ref" : "#/definitions/query" },
                { "$ref" : "#/definitions/query" }
            ],
            "minItems": 3,
            "maxItems": 3
        },

        "exists-query": {
            "type" : "array",
            "items": [
                {
                    "type" : "string",
                    "enum" : ["exists"]
                },
                { "$ref" : "#/definitions/query" }
            ],
            "maxItems": 2
        },

        "orderby-query": {
            "type" : "array",
            "items": [
                {
                    "type" : "string",
                    "enum" : ["orderby"]
                },
                { "$ref" : "types.json#/definitions/orderby-attribute-list" },
                { "$ref" : "#/definitions/query" }
            ],
            "minItems": 3,
            "maxItems": 3
        },

        "groupby-query": {
            "type" : "array",
            "items": [
                {
                    "type" : "string",
                    "enum" : ["groupby"]
                },
                { "$ref" : "types.json#/definitions/attribute-list-maybe" },
                { "$ref" : "#/definitions/query" }
            ],
            "minItems": 2,
            "maxItems": 3
        },

        "index-or-query" : {
            "type" : "array",
            "items": [
                {
                    "type" : "string",
                    "enum" : ["index-or"]
                },
                { "$ref" : "#/definitions/query" }
            ],
            "minItems": 3
        },

        "join-query": {
            "type" : "array",
            "items": [
                {
                    "type" : "string",
                    "enum" : ["join"]
                },
                { "$ref" : "types.json#/definitions/attribute-list-maybe" },
                { "$ref" : "#/definitions/query" },
                { "$ref" : "#/definitions/query" }
            ],
            "minItems": 4,
            "maxItems": 4
        },

        "let-query" : {
            "type" : "array",
            "items": [
                {
                    "type" : "string",
                    "enum" : ["let"]
                },
                { "$ref" : "types.json#/definitions/attribute-pair-list" },
                { "$ref" : "#/definitions/query" }
            ],
            "minItems": 3,
            "maxItems": 3
        },

        "merge-query" : {
            "type" : "array",
            "items": [
                {
                    "type" : "string",
                    "enum" : ["merge"]
                },
                { "$ref" : "#/definitions/query" }
            ],
            "minItems": 3
        },

        "nest-query" : {
            "type" : "array",
            "items": [
                {
                    "type" : "string",
                    "enum" : ["nest"]
                },
                { "type" : "string" },
                { "$ref" : "#/definitions/query" }
            ],
            "minItems": 3,
            "maxItems": 3
        },


        "or-query" : {
            "type" : "array",
            "items": [
                {
                    "type" : "string",
                    "enum" : ["or"]
                },
                { "$ref" : "#/definitions/query" }
            ],
            "minItems": 3
        },

        "random-query": {
            "type" : "array",
            "items": [
                {
                    "type" : "string",
                    "enum" : ["random"]
                },
                {   "type" : "integer" },
                { "$ref" : "#/definitions/query" }
            ],
            "minItems": 3,
            "maxItems": 3
        },

        "threadlast-query" : {
            "type" : "array",
            "items": [
                {
                    "type" : "string",
                    "enum" : ["->>"]
                },
                { "$ref" : "#/definitions/query" }
            ],
            "minItems": 3
        },

        "targets-query": {
            "type" : "array",
            "items": [
                {
                    "type" : "string",
                    "enum" : ["targets"]
                },
                { "$ref" : "types.json#/definitions/attribute-list" },
                { "$ref" : "#/definitions/query" }
            ],
            "maxItems": 3,
            "minItems": 3
        },

        "query" : {
            "anyOf" : [
                { "$ref": "queries.json#/definitions/query" },
                { "$ref": "#/definitions/aggregate-query" },
                { "$ref": "#/definitions/and-query" },
                { "$ref": "#/definitions/apply-query" },
                { "$ref": "#/definitions/difference-query" },
                { "$ref": "#/definitions/exists-query" },
                { "$ref": "#/definitions/groupby-query" },
                { "$ref": "#/definitions/index-or-query" },
                { "$ref": "#/definitions/join-query" },
                { "$ref": "#/definitions/let-query" },
                { "$ref": "#/definitions/merge-query" },
                { "$ref": "#/definitions/nest-query" },
                { "$ref": "#/definitions/or-query" },
                { "$ref": "#/definitions/orderby-query" },
                { "$ref": "#/definitions/random-query" },
                { "$ref": "#/definitions/targets-query" }
            ]
        }
    }
}
