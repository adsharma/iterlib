{
    "$schema": "http://json-schema.org/draft-04/schema#",
    "id": "file:///home/asharma/src/iterlib/python/queries.json",

    "type" : "object",
    "properties": {
        "query": { "$ref": "#/definitions/query" }
    },
    "definitions" : {
        "assoc-query": {
            "type" : "array",
            "items": [
                {
                    "type" : "string",
                    "enum" : ["assoc"]
                },
                {   "type" : "integer" },
                { "$ref" : "#/definitions/query" }
            ],
            "maxItems": 3
        },

        "count-query": {
            "type" : "array",
            "items": [
                {
                    "type" : "string",
                    "enum" : ["count"]
                },
                { "$ref" : "#/definitions/query" }
            ],
            "minItems": 2,
            "maxItems": 2
        },

        "obj-query": {
            "type" : "array",
            "items": [
                {
                    "type" : "string",
                    "enum" : ["obj"]
                },
                { "$ref" : "#/definitions/query" }
            ],
            "maxItems": 2
        },

        "filter-query" : {
            "type" : "array",
            "items": [
                {
                    "type" : "string",
                    "enum" : ["filter"]
                },
                { "type" : "array",
                    "items" : [
                        { "enum" : ["=", "inset", "prefix", "range", "contains",
                                    ">", ">=", "<", "<=", "!="] },
                        { "$ref" : "types.json#/definitions/attribute-name-or-list" },
                        { "$ref" : "types.json#/definitions/attribute-val-or-list" }
                    ],
                    "minItems": 3,
                    "maxItems": 3
                },
                { "$ref" : "#/definitions/query" }
            ]
        },

        "json-literal-query": {
            "type" : "array",
            "items": [
                {
                    "type" : "string",
                    "enum" : ["json_literal"]
                },
                {
                    "type" : "string"
                }
            ]
        },

        "limit-query": {
            "type" : "array",
            "items": [
                {
                    "type" : "string",
                    "enum" : ["limit"]
                },
                {   "type" : "integer"},
                { "$ref" : "#/definitions/query" }
            ],
            "minItems": 3,
            "maxItems": 3
        },

        "limit-offset-query": {
            "type" : "array",
            "items": [
                {
                    "type" : "string",
                    "enum" : ["limit"]
                },
                {   "type" : "integer"},
                {   "type" : "integer"},
                { "$ref" : "#/definitions/query" }
            ],
            "minItems": 4,
            "maxItems": 4
        },

        "literal-query": {
            "type" : "array",
            "items": [
                { "type" : "integer" },
                { "not" : { "type": "string" } }
            ]
        },

        "project-query": {
            "type" : "array",
            "items": [
                {
                    "type" : "string",
                    "enum" : ["project"]
                },
                { "$ref" : "types.json#/definitions/attribute-list" },
                { "$ref" : "#/definitions/query" }
            ],
            "minItems": 3,
            "maxItems": 3
        },

        "reverse-query": {
            "type" : "array",
            "items": [
                {
                    "type" : "string",
                    "enum" : ["reverse"]
                },
                { "$ref" : "#/definitions/query" }
            ],
            "minItems": 2,
            "maxItems": 2
        },


        "query" : {
            "anyOf" : [
                { "$ref": "#/definitions/assoc-query" },
                { "$ref": "#/definitions/count-query" },
                { "$ref": "#/definitions/obj-query" },
                { "$ref": "#/definitions/filter-query" },
                { "$ref": "#/definitions/json-literal-query" },
                { "$ref": "#/definitions/literal-query" },
                { "$ref": "#/definitions/limit-query" },
                { "$ref": "#/definitions/limit-offset-query" },
                { "$ref": "#/definitions/project-query" },
                { "$ref": "#/definitions/reverse-query" },

                { "$ref": "complex.json#/definitions/aggregate-query" },
                { "$ref": "complex.json#/definitions/and-query" },
                { "$ref": "complex.json#/definitions/apply-query" },
                { "$ref": "complex.json#/definitions/difference-query" },
                { "$ref": "complex.json#/definitions/exists-query" },
                { "$ref": "complex.json#/definitions/groupby-query" },
                { "$ref": "complex.json#/definitions/index-or-query" },
                { "$ref": "complex.json#/definitions/join-query" },
                { "$ref": "complex.json#/definitions/let-query" },
                { "$ref": "complex.json#/definitions/merge-query" },
                { "$ref": "complex.json#/definitions/nest-query" },
                { "$ref": "complex.json#/definitions/or-query" },
                { "$ref": "complex.json#/definitions/orderby-query" },
                { "$ref": "complex.json#/definitions/random-query" },
                { "$ref": "complex.json#/definitions/targets-query" }
            ]
        }
    }
}
